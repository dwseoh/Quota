# CodespaceGraph JSON Structure Example

This document shows an example of the `CodespaceGraph` JSON structure generated by the parser.

## Example Output

```json
{
  "version": "1.0.0",
  "timestamp": 1704920400000,
  "files": [
    {
      "path": "/workspace/src/api/openai_client.ts",
      "hash": "a1b2c3d4e5f6",
      "lastModified": 1704920350000,
      "units": [
        "/workspace/src/api/openai_client.ts:5:generateResponse",
        "/workspace/src/api/openai_client.ts:20:ChatClient",
        "/workspace/src/api/openai_client.ts:25:ChatClient.sendMessage"
      ]
    },
    {
      "path": "/workspace/src/services/payment.py",
      "hash": "f6e5d4c3b2a1",
      "lastModified": 1704920360000,
      "units": [
        "/workspace/src/services/payment.py:10:process_payment",
        "/workspace/src/services/payment.py:30:PaymentProcessor",
        "/workspace/src/services/payment.py:35:PaymentProcessor.charge"
      ]
    }
  ],
  "units": [
    {
      "id": "/workspace/src/api/openai_client.ts:5:generateResponse",
      "type": "function",
      "name": "generateResponse",
      "body": "async function generateResponse(prompt: string) {\n  const client = new OpenAI();\n  const response = await client.chat.completions.create({\n    model: \"gpt-4\",\n    messages: [{ role: \"user\", content: prompt }]\n  });\n  return response.choices[0].message.content;\n}",
      "dependencies": [
        "import { OpenAI } from 'openai';",
        "import * as dotenv from 'dotenv';"
      ],
      "location": {
        "fileUri": "/workspace/src/api/openai_client.ts",
        "startLine": 5,
        "startColumn": 0,
        "endLine": 12,
        "endColumn": 1
      }
    },
    {
      "id": "/workspace/src/api/openai_client.ts:20:ChatClient",
      "type": "class",
      "name": "ChatClient",
      "body": "class ChatClient {\n  private client: OpenAI;\n  \n  constructor() {\n    this.client = new OpenAI();\n  }\n  \n  async sendMessage(message: string) {\n    return await this.client.chat.completions.create({\n      model: \"gpt-3.5-turbo\",\n      messages: [{ role: \"user\", content: message }]\n    });\n  }\n}",
      "dependencies": [
        "import { OpenAI } from 'openai';"
      ],
      "location": {
        "fileUri": "/workspace/src/api/openai_client.ts",
        "startLine": 20,
        "startColumn": 0,
        "endLine": 33,
        "endColumn": 1
      }
    },
    {
      "id": "/workspace/src/services/payment.py:10:process_payment",
      "type": "function",
      "name": "process_payment",
      "body": "def process_payment(amount: float, token: str):\n    stripe.api_key = os.getenv('STRIPE_KEY')\n    charge = stripe.Charge.create(\n        amount=int(amount * 100),\n        currency='usd',\n        source=token\n    )\n    return charge",
      "dependencies": [
        "import stripe",
        "import os"
      ],
      "location": {
        "fileUri": "/workspace/src/services/payment.py",
        "startLine": 10,
        "startColumn": 0,
        "endLine": 17,
        "endColumn": 18
      }
    }
  ],
  "classifications": {
    "/workspace/src/api/openai_client.ts:5:generateResponse": {
      "role": "consumer",
      "category": "llm",
      "provider": "openai",
      "confidence": 0.98
    },
    "/workspace/src/api/openai_client.ts:20:ChatClient": {
      "role": "consumer",
      "category": "llm",
      "provider": "openai",
      "confidence": 0.95
    },
    "/workspace/src/api/openai_client.ts:25:ChatClient.sendMessage": {
      "role": "consumer",
      "category": "llm",
      "provider": "openai",
      "confidence": 0.97
    },
    "/workspace/src/services/payment.py:10:process_payment": {
      "role": "consumer",
      "category": "payment",
      "provider": "stripe",
      "confidence": 0.99
    }
  }
}
```

## Structure Explanation

### Top Level

- **version**: Schema version for compatibility tracking
- **timestamp**: Unix timestamp of last indexing
- **files**: Array of file nodes with metadata
- **units**: Array of all code units (functions, classes, methods)
- **classifications**: Map of unit IDs to their API classifications

### FileNode

Each file in the workspace has:
- **path**: Absolute file path
- **hash**: MD5 hash for change detection
- **lastModified**: File modification timestamp
- **units**: Array of unit IDs contained in this file

### CodeUnit

Each logical code unit has:
- **id**: Unique identifier (format: `filepath:line:name`)
- **type**: `function`, `class`, or `method`
- **name**: Function/class/method name
- **body**: Complete source code
- **dependencies**: Array of import statements
- **location**: Precise location metadata

### LocationMetadata

- **fileUri**: Absolute file path
- **startLine**: Starting line number (1-indexed)
- **startColumn**: Starting column number
- **endLine**: Ending line number
- **endColumn**: Ending column number

### ApiClassification

LLM-driven classification for each unit:
- **role**: `consumer` (calls APIs), `provider` (defines endpoints), or `none`
- **category**: `llm`, `payment`, `weather`, `database`, or `other`
- **provider**: Specific provider name (e.g., "openai", "stripe", "aws")
- **confidence**: Classification confidence score (0-1)

## Storage Location

The graph is stored in:
```
<workspace-root>/.delta-analytics-config/index.json
```

File hashes are stored separately in:
```
<workspace-root>/.delta-analytics-config/file-map.hash
```
